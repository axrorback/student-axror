{% extends "base.html" %}
{% block title %}Attendance — {{ lesson.title }}{% endblock %}

{% block content %}
<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2 mb-3">
  <div>
    <a href="{% url 'teacher_lessons' %}" class="btn btn-outline-secondary btn-sm mb-2">
      <i class="bi bi-arrow-left me-1"></i> Back
    </a>
    <h3 class="fw-semibold mb-1">{{ lesson.title }}</h3>
    <div class="text-soft">
      <i class="bi bi-calendar-event me-1"></i>{{ lesson.starts_at|date:"Y-m-d" }}
      <span class="ms-2"><i class="bi bi-clock me-1"></i>{{ lesson.starts_at|date:"H:i" }} – {{ lesson.ends_at|date:"H:i" }}</span>
      {% if lesson.location %}
        <span class="ms-2"><i class="bi bi-geo-alt me-1"></i>{{ lesson.location }}</span>
      {% endif %}
    </div>
  </div>

  <div class="text-soft small">
    <i class="bi bi-info-circle me-1"></i> Default: ABSENT
  </div>
</div>

<form method="post">
  {% csrf_token %}

  <div class="card card-soft p-3">
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead>
          <tr>
            <th>#</th>
            <th>AUID</th>
            <th>Full name</th>
            <th style="width:220px;">Status</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td class="fw-semibold">{{ r.student.auid }}</td>
              <td>{{ r.student.full_name|default:"—" }}</td>
              <td>
                <select class="form-select" name="status_{{ r.student.id }}">
                  {% for v, label in statuses.choices %}
                    <option value="{{ v }}" {% if r.status == v %}selected{% endif %}>{{ label }}</option>
                  {% endfor %}
                </select>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="d-flex gap-2 justify-content-end mt-3">
      <button type="submit" class="btn btn-brand">
        <i class="bi bi-save2 me-1"></i> Save Attendance
      </button>
    </div>
  </div>
</form>
{% endblock %}
